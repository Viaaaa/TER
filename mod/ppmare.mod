dvar boolean X[0..7][0..3];
dvar boolean Y[0..3][0..1];
dvar boolean S0[0..1];
dvar boolean S1[0..1];
dvar boolean S2[0..2];
dvar boolean S3[0..2];
dvar boolean S4[0..1];
dvar boolean S5[0..1];
dvar boolean S6[0..1];
dvar boolean S7[0..1];
dvar int S;
maximize S;

subject to{
	//Lignes agents
	X[0][0] + X[0][1] + X[0][2] + X[0][3] <= 1;
	X[1][0] + X[1][1] + X[1][2] + X[1][3] <= 1;
	X[2][0] + X[2][1] + X[2][2] + X[2][3] <= 1;
	X[3][0] + X[3][1] + X[3][2] + X[3][3] <= 1;
	X[4][0] + X[4][1] + X[4][2] + X[4][3] <= 1;
	X[5][0] + X[5][1] + X[5][2] + X[5][3] <= 1;
	X[6][0] + X[6][1] + X[6][2] + X[6][3] <= 1;
	X[7][0] + X[7][1] + X[7][2] + X[7][3] <= 1;

	//Colonnes agents
	X[0][0] + X[1][0] + X[2][0] + X[3][0] + X[4][0] + X[5][0] + X[6][0] + X[7][0] <= 1;
	X[0][1] + X[1][1] + X[2][1] + X[3][1] + X[4][1] + X[5][1] + X[6][1] + X[7][1] <= 1;
	X[0][2] + X[1][2] + X[2][2] + X[3][2] + X[4][2] + X[5][2] + X[6][2] + X[7][2] <= 1;
	X[0][3] + X[1][3] + X[2][3] + X[3][3] + X[4][3] + X[5][3] + X[6][3] + X[7][3] <= 1;

	//Egalite des croix agents
	X[0][0] == X[1][1];
	X[0][1] == X[1][0];
	X[0][2] == X[1][3];
	X[0][3] == X[1][2];

	X[2][0] == X[3][1];
	X[2][1] == X[3][0];
	X[2][2] == X[3][3];
	X[2][3] == X[3][2];

	X[4][0] == X[5][1];
	X[4][1] == X[5][0];
	X[4][2] == X[5][3];
	X[4][3] == X[5][2];

	X[6][0] == X[7][1];
	X[6][1] == X[7][0];
	X[6][2] == X[7][3];
	X[6][3] == X[7][2];

	//Lignes regles
	Y[0][0] + Y[0][1] <= 1;
	Y[1][0] + Y[1][1] <= 1;
	Y[2][0] + Y[2][1] <= 1;
	Y[3][0] + Y[3][1] <= 1;

	//Colonnes regles
	Y[0][0] + Y[1][0] + Y[2][0] + Y[3][0] <= 1;
	Y[0][1] + Y[1][1] + Y[2][1] + Y[3][1] <= 1;

	//Fonction d'evaluation
	S0[0] <= Y[0][0];	S0[0] <= X[0][0];	S0[0] >= Y[0][0] + X[0][0] - 1;
	S0[1] <= Y[0][0];	S0[1] <= X[3][3];	S0[1] >= Y[0][0] + X[3][3] - 1;

	S1[0] <= Y[0][1];	S1[0] <= X[0][3];	S1[0] >= Y[0][1] + X[0][3] - 1;
	S1[1] <= Y[0][1];	S1[1] <= X[3][1];	S1[1] >= Y[0][1] + X[3][1] - 1;

	S2[0] <= Y[1][0];	S2[0] <= X[2][0];	S2[0] >= Y[1][0] + X[2][0] - 1;
	S2[1] <= Y[1][0];	S2[1] <= X[4][3];	S2[1] >= Y[1][0] + X[4][3] - 1;
	S2[2] <= Y[1][0];	S2[2] <= X[6][3];	S2[2] >= Y[1][0] + X[6][3] - 1;

	S3[0] <= Y[1][1];	S3[0] <= X[2][3];	S3[0] >= Y[1][1] + X[2][3] - 1;
	S3[1] <= Y[1][1];	S3[1] <= X[4][1];	S3[1] >= Y[1][1] + X[4][1] - 1;
	S3[2] <= Y[1][1];	S3[2] <= X[6][1];	S3[2] >= Y[1][1] + X[6][1] - 1;

	S4[0] <= Y[2][0];	S4[0] <= X[4][0];	S4[0] >= Y[2][0] + X[4][0] - 1;
	S4[1] <= Y[2][0];	S4[1] <= X[7][3];	S4[1] >= Y[2][0] + X[7][3] - 1;

	S5[0] <= Y[2][1];	S5[0] <= X[4][3];	S5[0] >= Y[2][1] + X[4][3] - 1;
	S5[1] <= Y[2][1];	S5[1] <= X[7][1];	S5[1] >= Y[2][1] + X[7][1] - 1;

	S6[0] <= Y[3][0];	S6[0] <= X[7][0];	S6[0] >= Y[3][0] + X[7][0] - 1;
	S6[1] <= Y[3][0];	S6[1] <= X[5][3];	S6[1] >= Y[3][0] + X[5][3] - 1;

	S7[0] <= Y[3][1];	S7[0] <= X[7][3];	S7[0] >= Y[3][1] + X[7][3] - 1;
	S7[1] <= Y[3][1];	S7[1] <= X[5][1];	S7[1] >= Y[3][1] + X[5][1] - 1;

	S == 2*S0[0] + 2*S0[1] - 2 * Y[0][0]
	   + 2*S1[0] + 2*S1[1] - 2 * Y[0][1]
	   + 2*S2[0] + 2*S2[1] + 2*S2[2] - 3 * Y[1][0]
	   + 2*S3[0] + 2*S3[1] + 2*S3[2] - 3 * Y[1][1]
	   + 2*S4[0] + 2*S4[1] - 2 * Y[2][0]
	   + 2*S5[0] + 2*S5[1] - 2 * Y[2][1]
	   + 2*S6[0] + 2*S6[1] - 2 * Y[3][0]
	   + 2*S7[0] + 2*S7[1] - 2 * Y[3][1]
	  ;
}
